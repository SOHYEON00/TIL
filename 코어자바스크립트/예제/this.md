# this 헷갈리지 않고 판단하기
 
 <br/>

> 출처 : (정재남) 코어자바스크립트 <br/> <br/>
  너무 당연하게 알 것 같지만 은근히 헷갈리는 주제인 this!  <br/>
  경우의 수는 2가지 (함수/메서드) 이다. 

<br/>

### this의 종류

<br/>

~~종류라고 쓰자니 조금 그러하지만, 함수/메서드로 동작하는 지에 따라 this가 달라지기 때문에 종류라고 썼다.~~  

**this는 함수가 함수로서 동작하는지, 메서드로서 동작하는지에 따라 값이 달라진다.**  
그렇기 때문에 **함수가 무엇으로서 동작하는지를 핀단**하면 this가 무엇을 가리키는 지 알 수 있다.

가 가리키는 중요!
* 함수로서 동작할 때의 this : 전역 객체(window or global)
* 메서드로서 동작할 때의 this : 프로퍼티명 앞의 객체 = 마지막 점 앞에 명시된 객체

<br/>

### 예제 

<br/>

이제 예제를 통해 제대로 이해해보자.
>출처는 코어자바스크립트 책을 공부하며 개인적인 이해를 위해 정리하고자 작성하게 된 글이므로 예제 또한 책의 예제이다.


```
var obj1 = {
    outer: function () {
        console.log(this); --------------- (1)
        var innerFunc = function () {
            console.log(this); --------------- (2), (3)
        };
        innerFunc();

        var obj2 = {
            innerMethod: innerFunc(); 
        };
        obj2.innerMethod();
    }
};

obj.outer();
```

* 상황
    - (1) : obj.outer를 호출한 값 
    - (2) : innerFunc을 출력한 값
    - (3) : obj2.innerMethod를 호출한 값

상황을 읽으며 예상했겠지만 각 상황의 출력값은 obj / window (browser환경) / obj2 이다.  
출력값을 이해하기 위해서는 각 상황에서 함수가 무엇으로서, 즉 함수로서 동작했는지 또는 메소드로서 동작했는지를 이해해야 한다.

<br/>

* 각 상황 설명

01. (1)번 상황  
    (1)은 상대적으로 이해하기 쉬울 것이다.  
    obj.outer가 호출된 상황이고 이 때, outer는 obj의 메소드이며 익명함수를 프로퍼티의 값으로 가진다.  
    outer가 obj의 메서드로서 동작했기 때문에 this가 가리키는 값은 obj가 된다.

02. (2)번 상황  
    우선 innerFunc은 outer안에서 익명함수를 값으로 가지는 변수로 선언되었다.  
    그리고 obj.outer 값인 함수 안에서 innerFunc()이 실행되었다.  

    변수 innerFunc은 outer 스코프 내에서만 접근할 수 있는 지역변수이다.  
    innerFunc이 obj의 메서드인 outer안에서 정의.실행되었다고 하더라도 어떠한 객체의 메서드로서 동작한 것이 아니라 함수로서 동작했음을 알아야 한다.  

    이 때 메서드로서 동작했다고 잘못 이해한다면 (2)번 상황의 출력값을 obj 또는 obj2라고 예상했을 것이다.  틀렸다.  
    함수로서 동작했기 때문에 this가 가리키는 값은 전역객체인 window가 된다. 

    > 함수로서 호출되면 this는 지정되지 않으므로 스코프 체인상의 최상위 객체인 전역객체를 가리키게 된다.

03. (3)번 상황  
    (3)번은 (2)번 상황과 같은 위치에서 출력이 실행되지만 obj.outer 메서드 스코프에 위치한 객체 obj2의 innerMethod 메서드 실행값이다.  
    obj안의 obj2 어쩌구 이렇게 이해하면 안되고 우리는 this의 값만 알면 된다. 간단히 말해서 함수가 메서드로 동작했다면 .에 가장 가까운 객체가 this이다. 즉, this는 obj2를 가리킨다.


<br/>


🔴 이러나 저러나 함수를 실행할 때, 당시의 환경보다는 함수를 호출하는 구문을 잘 보자!  
그것만으로 충분히 무엇으로 호출된 것인지 판단할 수 있다.